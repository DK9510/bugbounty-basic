# Directory Traversal

![Directory-traversal.png](Directory%20Traversal%201f22da87c07d4335bd464bd472f4c98a/Directory-traversal.png)

## what is Directory Traversal/Path Traversal

- it is also known as `path-traversal` vulnerability that include application `data,code,credentials,sensitive os files`
- if some of these files have write permission, allowing attacker to modify the content of the file and take full control of the server.

## reading arbitrary files via directory traversal

```
<img src="/loadImage?filename=218.png">

```

in this request send to `?filename=` parameter which we can exploit by traversing path like

```
<https://vuln-web.com/Loadimage?filename=../../../../etc/passwd>(or any sysfiles)

```

## prevention

- to avoid passing user-supplied input to filesystem APIs altogether. Many application functions that do this can be rewritten to deliver the same behavior in a safer way.

# exploitation

- Many applications that place user input into file paths implement some kind of defense against path traversal attacks, and these can often be circumvented.
- if application blocks or strips directory traversal sequence there is many bypassing technique is available
- we might directly access absolute path `file=/etc/passwd` with out using any traversal.
- You might be able to use various non-standard encoding, such as `..%c0%af` or `..%252f`, to bypass the input filter.
- [filter-bypass-technique](https://code.google.com/archive/p/teenage-mutant-ninja-turtles/wikis/AdvancedObfuscationPathtraversal.wiki)
- might user `....//`or `....\\\\`if one `..../ or ....\\` is blocked than after removing them we traverse it.
- If an application requires that the user-supplied filename must start with the expected base folder, such as `/var/www/images`, then it might be possible to include the required base folder followed by suitable traversal sequences. For example:`filename=/var/www/images/../../../etc/passwd`
- If an application requires that the user-supplied filename must end with an expected file extension, such as `.png`, then it might be possible to use a null byte to effectively terminate the file path before the required extension. For example:`filename=../../../etc/passwd%00.png`

eg. we found URL
`https://app.com/api/v1/user?id=1337`

- most of people try to find SQL Injection on this endpoint
- but some `microservice architecture` use that as Path to the internal eg

```
Folow of the reqest
Hacker: <https://app.com/api/v1/user?id=1337>
Microservice: <https://user-service.app.internal/users/1337>
Content-Returned to User

```

PAth Traversal

```
Hacker <https://app.com/api/v1/user?id=1337/../../../>
Microservice: <https://user-service.app.internal/user/1337/../../../>
	url normalise to <https://user-service.app.internal/>
Content-returned to Hacker

```

Try to Request it with all methods, GET,POST, PUT,DELETE,PATCH, HEAD

- after path traversal do some fuzzing in path to detect any other end point that have been used for other API endpoint
- the new APi endpoint we have found after path traversal fuzzing, there new functionality that may be have critical vulnerability.