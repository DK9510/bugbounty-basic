## SSRF attack against other back-end system
- it arises when ssrf is where the application server is able to interact with other back-end systems that are not directly reachable by normal users.
- these also have `non-routable IP` address so it can't be accessed by Outer network.
- since they are not exposed to outer network they may contain some sensitive information and functionality without any authentication
- `example:` if they have administrative interface at `192.168.0.95/admin`
```js
POST /product/stock HTTP/1.0  
Content-Type: application/x-www-form-urlencoded  
Content-Length: 118  
  
stockApi=http://192.168.0.68/admin
```
got admin access

# Circumventing Common SSRF defenses

## SSRF with Blacklist-Based Input Filters
- some application block input containing hostname like `127.0.0.1 or localhost or sensitive URL like /admin etc`
- **ByPass**
- using alternative representation of `127.0.0.1` like
- `2130706433, 017700000001 , 127.1`
- registering own domain that resolves to 127.0.0.1, we use spoofed.burpcollaborator.net
- `Obfuscating blocked strings using URL encoding or case Variation`
- some times we need to `doble or tripple times` encoding the payload to bypass filter.

## SSRF with Whitelist-based input filters
- some applications only allow input that matches, begins with or Contains, a whitelist or permitted values.
- we evade filter in this situation by exploiting inconsistencies in `URL Parsing`
- You can use the `#` character to indicate a URL fragment. For example: `https://attacker-host#expected-host`.
- we can leverage DNS naming hierarchy to place required input into a fully-Qualified DNS name that we control. example: `https://white-list-domain.attacker-host`.
- You can URL-encode characters to confuse the URL-parsing code. This is particularly useful if the code that implements the filter handles URL-encoded characters differently than the code that performs the back-end HTTP request.
- also use combination of these techniques and also see [PayloadAllTheThings](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Request%20Forgery).
- some times we need to carefully see the response for exploiting ssrf that how it parsing our input.

## Bypassing SSRF filters via Open-Redirection
- sometimes possible to circumvent any kind of filter-based defenses by exploiting an `open redirect` vulnerability.
- `example: `
- if user submitted URL is strictly validated to prevent malicious exploitation of `SSRF` behavior. but if it allows `open Redirect` vulnerability. Provided the API used to make the back-end HTTP request supports redirection, we construct a URL that  satisfies filter and result in a redirected request to the desired back-end target.
```js
/product/nextProduct?currentProductId=6&path=http://attacker.domain
```
returns redirected to `http://attacker.domain`
we leverage `open redirect `vuln to bypass the URL filter and exploit `SSRF`
```js
POST /product/stock HTTP/1.0  
Content-Type: application/x-www-form-urlencoded  
Content-Length: 118  
  
stockApi=http://weliketoshop.net/product/nextProduct?currentProductId=6&path=http://192.168.0.68/admin
```
- this exploit works because it first validate allowed domain and request trigger `open redirect` to make request to desired domain.


