- attack surface for XXE injection vulnerability is obvious in many cases, because the application's normal http traffic includes request that contain data in XML format
- in other case attack surface is less visible, if we look at the right place, we find XXE attack surface in requests that do not contain any XML.

## XInclude Attacks
- application receive client-submitted data, embed it on the server-side into an  XML document, and then parse the document, 
- an example this occurs when client-submitted data is placed into a back-end `SOAP request`, which is then processed by the back-end SOAP service.
- in this situation, you cannot carry out a classic XXE attack, because we can not control entire XML document and so can not define or modify a `DOCTYPE` element.
- but we might able to use `XInclude` instead.
- `Xinclude` is part of XML specification that allows an XML document to be built from sub-documents. we place an `XInclude` attack with any data value in an XML document, so the attack can be performed in situation where you only control a single item of data that is placed into a server-side XML document.
- to performs an `XInclude` attack you need to reference the Xinclude namespace and provide the path to the file that you wish to include for example:
```js
<root xmlns:xi="http://www.w3.org/2001/XInclude"><xi:include parse="text" href="file:///etc/passwd"/></root>
```

## XXE attacks via File upload
- some applications allow users to upload files which are then processed server-side.
- some common file formats use XML or Contains XML sub-components.
- Example: XML based formats are office documents like `DOCX` and image formats like `SVG`
- for example: application might allow user to upload images, and process or validate these on the server after they are uploaded. 
- even if the application expects to receive a format like `PNG or JPEG` the Image processing library that is being used might support `SVG` images, since the SVG format uses `XML`. an attacker can submit a `malicious SVG` image and so read hidden attack surface for XXE vulnerabilities.
**EXploit :**
```bash
<?xml version="1.0" standalone="yes"?><!DOCTYPE test \[ <!ENTITY xxe SYSTEM "file:///etc/hostname" > \]><svg w  
idth="128px" height="128px" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" vers  
ion="1.1"><text font-size="16" x="0" y="16">&xxe;</text></svg>
```
**request looks like this**
```js
Content-Disposition: form-data; name="avatar"; filename="exploit.svg"
Content-Type: image/svg+xml

<?xml version="1.0" standalone="yes"?><!DOCTYPE root [<!ENTITY dk SYSTEM "file:///etc/hostname"> ]><svg width="128px" height="128px" xmlns="http://www.w3.org./2000/svg" xmlns:xlink="http://www.w3.org/1999/Xlink" version="1.1"><text font-size="16" x="0" y="16">&dk;</text></svg>
```

## XXE via Modified Content Type
- most `POST` request use a default content-type that has generated by HTML Forms such as `application/x-www-form-urlencoded` 
- some server expect to receive request in this format but this format will be tolerate other content types, including XML
```js
POST /action HTTP/1.0
Content-Type: application/x-www-form-urlencoded
Content-Length: 7

parameter=value
```
we will tolerate this request and convert this content type into XML
```js
POST /action HTTP/1.0
Content-Type: text/xml
Content-Length: 63 {here we need to put length of our payload i.e charector length of xml DTD}

<?xml version="1.0" encoding="UTF-8"?><parameter>value</parameter>
```
- if application tolerates request containing XML in the message Body and parse the body content as XML, then you reach the `hidden XXE` attack surface simply by reformating request to use the XML format.

# How to find and test for XXE vulnerability 
- Testing for `file retrievel ` by defining an external entity based on a well-known operation system file  and using that entity in data that is returned in the application's response.
- Testing for `Blind XXE vuln` by defining an external Entity based on a URL to a system that you control, and  monitoring for interaction with that system.
- Testing for vulnerability inclusion of user-supplied non-XML data within a server-side XML document by using an `XInclude attack` to try to retrieve a well-known operation system file.
